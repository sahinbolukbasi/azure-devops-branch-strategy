# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Business Central CI/CD Pipeline
# Branch Strategy: feature/* â†’ sandbox â†’ release â†’ main
# Environments: Sandbox (Dev/Test) | Production (CanlÄ±)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 
# BRANCH HÄ°YERARÅÄ°SÄ°: 
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ main (Production)                                                           â”‚
# â”‚   â”œâ”€â”€ â† release (PR ile merge)                                              â”‚
# â”‚   â”œâ”€â”€ â† hotfix/* (Acil dÃ¼zeltmeler - main'den aÃ§Ä±lÄ±r, main'e merge olur)   â”‚
# â”‚   â”‚                                                                         â”‚
# â”‚ release (Pre-Production/UAT)                                                â”‚
# â”‚   â”œâ”€â”€ â† sandbox (PR ile merge)                                              â”‚
# â”‚   â”œâ”€â”€ â† bugfix/* (Release dÃ¼zeltmeleri - release'den aÃ§Ä±lÄ±r)               â”‚
# â”‚   â”‚                                                                         â”‚
# â”‚ sandbox (Development/Test)                                                  â”‚
# â”‚   â”œâ”€â”€ â† feature/* (Yeni Ã¶zellikler - sandbox'dan aÃ§Ä±lÄ±r)                   â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
# AKIÅ: 
# 1.Yeni Ã¶zellik:   sandbox â†’ feature/* â†’ sandbox â†’ release â†’ main
# 2.Release fix:   release â†’ bugfix/* â†’ release â†’ main (sonra back-merge)
# 3.Hotfix:        main â†’ hotfix/* â†’ main (sonra back-merge:  mainâ†’releaseâ†’sandbox)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

trigger:
  branches: 
    include: 
      - main
      - release
      - sandbox
      - feature/*
      - bugfix/*
      - hotfix/*

pr:
  branches: 
    include: 
      - main
      - release
      - sandbox

variables:
  # Branch Detection
  isMain: $[eq(variables['Build.SourceBranch'], 'refs/heads/main')]
  isRelease: $[eq(variables['Build.SourceBranch'], 'refs/heads/release')]
  isSandbox:  $[eq(variables['Build.SourceBranch'], 'refs/heads/sandbox')]
  isFeature: $[startsWith(variables['Build.SourceBranch'], 'refs/heads/feature/')]
  isBugfix: $[startsWith(variables['Build.SourceBranch'], 'refs/heads/bugfix/')]
  isHotfix:  $[startsWith(variables['Build.SourceBranch'], 'refs/heads/hotfix/')]
  isPR: $[eq(variables['Build.Reason'], 'PullRequest')]
  
  # Build Configuration
  buildConfiguration: 'Release'

pool:
  vmImage: windows-latest

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# STAGES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

stages:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # STAGE 1: PR VALIDATION - Branch kurallarÄ±nÄ± kontrol et
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - stage:  Validate
    displayName: "ğŸ” PR Validation"
    condition: eq(variables.isPR, true)
    jobs: 
      - job: ValidateBranchRules
        displayName: "Branch Rules Check"
        steps: 
          - checkout:  none

          - powershell:  |
              # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              # Branch Validation Script
              # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              
              $sourceBranch = "$(System.PullRequest.SourceBranch)" -replace "refs/heads/", ""
              $targetBranch = "$(System.PullRequest.TargetBranch)" -replace "refs/heads/", ""
              
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
              Write-Host "                    PR VALIDATION                              "
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
              Write-Host ""
              Write-Host "ğŸ“¤ Source Branch: $sourceBranch"
              Write-Host "ğŸ“¥ Target Branch: $targetBranch"
              Write-Host ""
              
              $valid = $false
              $errorMessage = ""
              
              switch ($targetBranch) {
                  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                  # MAIN BRANCH RULES
                  # Main'e sadece release veya hotfix/* merge edilebilir
                  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                  "main" {
                      if ($sourceBranch -eq "release" -or $sourceBranch -like "hotfix/*") {
                          $valid = $true
                      } else {
                          $errorMessage = @"
              
              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
              â•‘               âŒ MAIN BRANCH KURALI Ä°HLALÄ°!                        â•‘
              â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
              â•‘                                                                  â•‘
              â•‘  Main branch'e sadece ÅŸu kaynaklardan PR aÃ§Ä±labilir:            â•‘
              â•‘                                                                  â•‘
              â•‘    âœ… release      â†’ Normal release akÄ±ÅŸÄ±                        â•‘
              â•‘    âœ… hotfix/*     â†’ Acil canlÄ± dÃ¼zeltmeleri                     â•‘
              â•‘                                                                  â•‘
              â•‘  âŒ Sizin kaynak branch'iniz:  $sourceBranch
              â•‘                                                                  â•‘
              â•‘  ğŸ“‹ DoÄŸru AkÄ±ÅŸ:                                                   â•‘
              â•‘     feature/* â†’ sandbox â†’ release â†’ main                         â•‘
              â•‘                                                                  â•‘
              â•‘  ğŸ”¥ Hotfix iÃ§in:                                                  â•‘
              â•‘     main'den hotfix/* branch'i aÃ§Ä±n                              â•‘
              â•‘                                                                  â•‘
              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              "@
                      }
                  }
                  
                  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                  # RELEASE BRANCH RULES
                  # Release'e sadece sandbox veya bugfix/* merge edilebilir
                  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                  "release" {
                      if ($sourceBranch -eq "sandbox" -or $sourceBranch -like "bugfix/*") {
                          $valid = $true
                      } else {
                          $errorMessage = @"
              
              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
              â•‘             âŒ RELEASE BRANCH KURALI Ä°HLALÄ°!                     â•‘
              â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
              â•‘                                                                  â•‘
              â•‘  Release branch'e sadece ÅŸu kaynaklardan PR aÃ§Ä±labilir:         â•‘
              â•‘                                                                  â•‘
              â•‘    âœ… sandbox      â†’ Normal geliÅŸtirme akÄ±ÅŸÄ±                     â•‘
              â•‘    âœ… bugfix/*     â†’ Release ortamÄ± dÃ¼zeltmeleri                 â•‘
              â•‘                                                                  â•‘
              â•‘  âŒ Sizin kaynak branch'iniz: $sourceBranch
              â•‘                                                                  â•‘
              â•‘  ğŸ“‹ DoÄŸru AkÄ±ÅŸ:                                                  â•‘
              â•‘     feature/* â†’ sandbox â†’ release                                â•‘
              â•‘                                                                  â•‘
              â•‘  ğŸ› Bugfix iÃ§in:                                                 â•‘
              â•‘     release'den bugfix/* branch'i aÃ§Ä±n                           â•‘
              â•‘                                                                  â•‘
              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              "@
                      }
                  }
                  
                  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                  # SANDBOX BRANCH RULES
                  # Sandbox'a sadece feature/* merge edilebilir
                  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                  "sandbox" {
                      if ($sourceBranch -like "feature/*") {
                          $valid = $true
                      } else {
                          $errorMessage = @"
              
              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
              â•‘             âŒ SANDBOX BRANCH KURALI Ä°HLALÄ°!                     â•‘
              â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
              â•‘                                                                  â•‘
              â•‘  Sandbox branch'e sadece ÅŸu kaynaklardan PR aÃ§Ä±labilir:         â•‘
              â•‘                                                                  â•‘
              â•‘    âœ… feature/*     â†’ Yeni Ã¶zellik geliÅŸtirmeleri               â•‘
              â•‘                                                                  â•‘
              â•‘  âŒ Sizin kaynak branch'iniz: $sourceBranch
              â•‘                                                                  â•‘
              â•‘  ğŸ“‹ Yeni GeliÅŸtirme BaÅŸlatmak Ä°Ã§in:                              â•‘
              â•‘     1.sandbox branch'ine geÃ§in                                  â•‘
              â•‘     2.feature/yeni-ozellik adÄ±nda branch aÃ§Ä±n                   â•‘
              â•‘     3.GeliÅŸtirmeyi tamamlayÄ±n                                   â•‘
              â•‘     4.sandbox'a PR aÃ§Ä±n                                         â•‘
              â•‘                                                                  â•‘
              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              "@
                      }
                  }
                  
                  default {
                      Write-Host "âš ï¸ Target branch '$targetBranch' iÃ§in Ã¶zel kural tanÄ±mlanmamÄ±ÅŸ."
                      $valid = $true
                  }
              }
              
              # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
              # SonuÃ§
              # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
              if ($valid) {
                  Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                  Write-Host "âœ… PR VALIDATION BAÅARILI"
                  Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                  Write-Host ""
                  Write-Host "   $sourceBranch â†’ $targetBranch âœ“"
                  Write-Host ""
              } else {
                  Write-Host "##[error]$errorMessage"
                  exit 1
              }
            displayName:  "ğŸ” Validate Branch Rules"
            failOnStderr: true

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # STAGE 2: BUILD
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - stage: Build
    displayName: "ğŸ”¨ Build"
    dependsOn:  Validate
    condition:  |
      or(
        and(succeeded(), eq(variables.isPR, true)),
        and(always(), ne(variables.isPR, true))
      )
    jobs:
      - job: CompileAndPackage
        displayName: "Compile AL Application"
        timeoutInMinutes:  60
        steps: 
          - checkout: self
            clean: true
            fetchDepth: 0

          - task: PowerShell@2
            displayName: "ğŸ“¦ Build & Package"
            inputs: 
              targetType: inline
              script: |
                Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                Write-Host "                    BUILD STARTED                             "
                Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                Write-Host ""
                Write-Host "Branch: $(Build.SourceBranch)"
                Write-Host "Build Number: $(Build.BuildNumber)"
                Write-Host ""
                
                # CompileApp.ps1 varsa Ã§alÄ±ÅŸtÄ±r
                if (Test-Path "$(Build.SourcesDirectory)/CompileApp.ps1") {
                    Write-Host "CompileApp.ps1 bulundu, Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor..."
                    & "$(Build.SourcesDirectory)/CompileApp.ps1"
                } else {
                    Write-Host "##[warning]CompileApp.ps1 bulunamadÄ±. Ã–rnek build iÅŸlemi yapÄ±lÄ±yor..."
                    
                    # Staging dizini oluÅŸtur
                    New-Item -ItemType Directory -Force -Path "$(Build.StagingDirectory)" | Out-Null
                    
                    # Build bilgisi dosyasÄ± oluÅŸtur
                    @{
                        BuildNumber = "$(Build.BuildNumber)"
                        Branch = "$(Build.SourceBranch)"
                        Commit = "$(Build.SourceVersion)"
                        BuildDate = (Get-Date).ToString("yyyy-MM-dd HH:mm:ss")
                    } | ConvertTo-Json | Out-File "$(Build.StagingDirectory)/build-info.json"
                    
                    Write-Host "Build bilgisi oluÅŸturuldu."
                }
              workingDirectory: $(Build.SourcesDirectory)

          - publish: $(Build.StagingDirectory)
            artifact: drop
            displayName:  "ğŸ“¤ Publish Artifact"
            condition: succeededOrFailed()

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # STAGE 3: DEPLOY TO SANDBOX
  # Sandbox ve Feature branch'leri iÃ§in
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - stage: DeployToSandbox
    displayName:  "ğŸ§ª Deploy to Sandbox"
    dependsOn: Build
    condition: |
      and(
        succeeded(),
        ne(variables.isPR, true),
        or(
          eq(variables.isSandbox, true),
          eq(variables.isFeature, true)
        )
      )
    jobs:
      - deployment: DeploySandboxEnv
        displayName: "Deploy to Sandbox Environment"
        environment:  Sandbox
        strategy:
          runOnce:
            deploy:
              steps: 
                - download: current
                  artifact: drop
                  displayName: "ğŸ“¥ Download Artifact"

                - powershell: |
                    Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    Write-Host "              ğŸ§ª SANDBOX DEPLOYMENT                           "
                    Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    Write-Host ""
                    Write-Host "Environment:  Sandbox"
                    Write-Host "Branch: $(Build.SourceBranch)"
                    Write-Host ""
                    
                    # Burada gerÃ§ek deployment scriptinizi Ã§aÄŸÄ±rÄ±n
                    # Ã–rnek: Publish-BCContainerApp, Docker deployment vb.
                    
                    Write-Host "âœ… Sandbox deployment baÅŸarÄ±lÄ±!"
                  displayName: "ğŸš€ Deploy to Sandbox"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # STAGE 4: RELEASE STAGING
  # Release ve Bugfix branch'leri iÃ§in (Pre-Production Test)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - stage: ReleaseStaging
    displayName: "ğŸ¯ Release Staging"
    dependsOn: Build
    condition: |
      and(
        succeeded(),
        ne(variables.isPR, true),
        or(
          eq(variables.isRelease, true),
          eq(variables.isBugfix, true)
        )
      )
    jobs:
      - deployment: ReleaseStagingEnv
        displayName: "Deploy to Release Staging"
        environment:  Sandbox
        strategy: 
          runOnce:
            deploy: 
              steps: 
                - download: current
                  artifact:  drop
                  displayName: "ğŸ“¥ Download Artifact"

                - powershell: |
                    Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    Write-Host "              ğŸ¯ RELEASE STAGING DEPLOYMENT                   "
                    Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    Write-Host ""
                    Write-Host "Environment: Release Staging (Pre-Production Test)"
                    Write-Host "Branch:  $(Build.SourceBranch)"
                    Write-Host ""
                    
                    Write-Host "âœ… Release staging deployment baÅŸarÄ±lÄ±!"
                  displayName:  "ğŸš€ Deploy to Release Staging"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # STAGE 5: DEPLOY TO PRODUCTION
  # Main ve Hotfix branch'leri iÃ§in
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - stage: DeployToProduction
    displayName: "ğŸŒŸ Deploy to Production"
    dependsOn: Build
    condition: |
      and(
        succeeded(),
        ne(variables.isPR, true),
        or(
          eq(variables.isMain, true),
          eq(variables.isHotfix, true)
        )
      )
    jobs:
      - deployment: DeployProductionEnv
        displayName: "Deploy to Production Environment"
        environment: Production
        strategy: 
          runOnce: 
            deploy: 
              steps:
                - download: current
                  artifact: drop
                  displayName: "ğŸ“¥ Download Artifact"

                - powershell: |
                    Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    Write-Host "              ğŸŒŸ PRODUCTION DEPLOYMENT                        "
                    Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    Write-Host ""
                    Write-Host "Environment: Production"
                    Write-Host "Branch: $(Build.SourceBranch)"
                    Write-Host ""
                    
                    Write-Host "âœ… Production deployment baÅŸarÄ±lÄ±!"
                  displayName: "ğŸš€ Deploy to Production"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # STAGE 6: BACK-MERGE (Main â†’ Release â†’ Sandbox)
  # Production deployment sonrasÄ± tÃ¼m branch'leri senkronize et
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - stage: BackMergeFromMain
    displayName: "ğŸ”„ Back-Merge (Main)"
    dependsOn: DeployToProduction
    condition: |
      and(
        succeeded(),
        eq(variables.isMain, true)
      )
    jobs:
      - job: SyncBranchesFromMain
        displayName:  "Sync:  Main â†’ Release â†’ Sandbox"
        steps: 
          - checkout: self
            persistCredentials: true
            fetchDepth:  0

          - powershell: |
              # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              # Back-Merge Script:  Main â†’ Release â†’ Sandbox
              # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
              Write-Host "              ğŸ”„ BACK-MERGE BAÅLATILIYOR                       "
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
              Write-Host ""
              
              # Git KonfigÃ¼rasyonu
              git config user.email "devops-bot@pargesoft.com"
              git config user.name "DevOps Bot"
              git fetch origin --prune
              
              $hasError = $false
              $errorMessages = @()
              
              # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
              # ADIM 1: Main â†’ Release
              # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
              Write-Host ""
              Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
              Write-Host "ğŸ“Œ ADIM 1: Main â†’ Release senkronizasyonu"
              Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
              
              git checkout release 2>&1
              if ($LASTEXITCODE -ne 0) {
                  Write-Host "##[warning]Release branch bulunamadÄ±, oluÅŸturuluyor..."
                  git checkout -b release origin/main 2>&1
              }
              
              git pull origin release --no-edit 2>&1
              
              # Merge iÅŸlemi
              $mergeOutput = git merge origin/main -m "[skip ci] ğŸ”„ Auto-merge:  Main â†’ Release" --no-edit 2>&1
              
              if ($LASTEXITCODE -ne 0) {
                  Write-Host "##[error]âŒ CONFLICT: Main â†’ Release merge baÅŸarÄ±sÄ±z!"
                  Write-Host $mergeOutput
                  
                  git merge --abort 2>&1
                  
                  $hasError = $true
                  $errorMessages += @"
              
              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
              â•‘           âš ï¸ MAIN â†’ RELEASE CONFLICT DETECTED                    â•‘
              â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
              â•‘                                                                  â•‘
              â•‘  Manuel Ã§Ã¶zÃ¼m gerekiyor:                                         â•‘
              â•‘                                                                  â•‘
              â•‘  1.git checkout release                                         â•‘
              â•‘  2.git pull origin release                                      â•‘
              â•‘  3.git merge origin/main                                        â•‘
              â•‘  4. Conflict'leri Ã§Ã¶zÃ¼n                                          â•‘
              â•‘  5.git add .                                                    â•‘
              â•‘  6.git commit -m "Merge main into release"                      â•‘
              â•‘  7.git push origin release                                      â•‘
              â•‘                                                                  â•‘
              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              "@
              } else {
                  git push origin release 2>&1
                  if ($LASTEXITCODE -eq 0) {
                      Write-Host "âœ… Main â†’ Release senkronizasyonu baÅŸarÄ±lÄ±!"
                  } else {
                      Write-Host "##[warning]Push baÅŸarÄ±sÄ±z, muhtemelen deÄŸiÅŸiklik yok."
                  }
              }
              
              # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
              # ADIM 2: Release â†’ Sandbox
              # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
              Write-Host ""
              Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
              Write-Host "ğŸ“Œ ADIM 2: Release â†’ Sandbox senkronizasyonu"
              Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
              
              git checkout sandbox 2>&1
              if ($LASTEXITCODE -ne 0) {
                  Write-Host "##[warning]Sandbox branch bulunamadÄ±, oluÅŸturuluyor..."
                  git checkout -b sandbox origin/release 2>&1
              }
              
              git pull origin sandbox --no-edit 2>&1
              
              # Merge iÅŸlemi
              $mergeOutput = git merge origin/release -m "[skip ci] ğŸ”„ Auto-merge:  Release â†’ Sandbox" --no-edit 2>&1
              
              if ($LASTEXITCODE -ne 0) {
                  Write-Host "##[error]âŒ CONFLICT: Release â†’ Sandbox merge baÅŸarÄ±sÄ±z!"
                  Write-Host $mergeOutput
                  
                  git merge --abort 2>&1
                  
                  $hasError = $true
                  $errorMessages += @"
              
              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
              â•‘         âš ï¸ RELEASE â†’ SANDBOX CONFLICT DETECTED                   â•‘
              â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
              â•‘                                                                  â•‘
              â•‘  Manuel Ã§Ã¶zÃ¼m gerekiyor:                                         â•‘
              â•‘                                                                  â•‘
              â•‘  1.git checkout sandbox                                         â•‘
              â•‘  2.git pull origin sandbox                                      â•‘
              â•‘  3.git merge origin/release                                     â•‘
              â•‘  4.Conflict'leri Ã§Ã¶zÃ¼n                                          â•‘
              â•‘  5.git add .                                                   â•‘
              â•‘  6.git commit -m "Merge release into sandbox"                   â•‘
              â•‘  7.git push origin sandbox                                      â•‘
              â•‘                                                                  â•‘
              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              "@
              } else {
                  git push origin sandbox 2>&1
                  if ($LASTEXITCODE -eq 0) {
                      Write-Host "âœ… Release â†’ Sandbox senkronizasyonu baÅŸarÄ±lÄ±!"
                  } else {
                      Write-Host "##[warning]Push baÅŸarÄ±sÄ±z, muhtemelen deÄŸiÅŸiklik yok."
                  }
              }
              
              # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
              # SonuÃ§
              # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
              Write-Host ""
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
              
              if ($hasError) {
                  Write-Host "##[warning]âš ï¸ BACK-MERGE TAMAMLANDI (CONFLICT'LER VAR)"
                  foreach ($msg in $errorMessages) {
                      Write-Host $msg
                  }
                  Write-Host "##[warning]LÃ¼tfen yukarÄ±daki conflict'leri manuel olarak Ã§Ã¶zÃ¼n."
              } else {
                  Write-Host "âœ… BACK-MERGE BAÅARIYLA TAMAMLANDI"
                  Write-Host ""
                  Write-Host "   Main â†’ Release â†’ Sandbox âœ“"
              }
              
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            displayName: "ğŸ”„ Execute Back-Merge"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # STAGE 7: HOTFIX BACK-MERGE
  # Hotfix merge sonrasÄ±:  Main â†’ Release â†’ Sandbox
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - stage: BackMergeFromHotfix
    displayName: "ğŸ”¥ Hotfix Back-Merge"
    dependsOn: DeployToProduction
    condition: |
      and(
        succeeded(),
        eq(variables.isHotfix, true)
      )
    jobs:
      - job: SyncAfterHotfix
        displayName: "Sync After Hotfix"
        steps:
          - checkout: self
            persistCredentials: true
            fetchDepth:  0

          - powershell: |
              # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              # Hotfix Back-Merge Script
              # Hotfix main'e merge edildikten sonra tÃ¼m branch'lere yayÄ±lmalÄ±
              # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
              Write-Host "           ğŸ”¥ HOTFIX BACK-MERGE BAÅLATILIYOR                  "
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
              Write-Host ""
              Write-Host "Hotfix Branch: $(Build.SourceBranch)"
              Write-Host ""
              
              git config user.email "devops-bot@pargesoft.com"
              git config user.name "DevOps Bot"
              git fetch origin --prune
              
              $hotfixBranch = "$(Build.SourceBranch)" -replace "refs/heads/", ""
              
              # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
              # ADIM 1: Hotfix â†’ Release
              # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
              Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
              Write-Host "ğŸ“Œ ADIM 1: Hotfix â†’ Release"
              Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
              
              git checkout release 2>&1
              git pull origin release --no-edit 2>&1
              
              $mergeOutput = git merge "origin/$hotfixBranch" -m "[skip ci] ğŸ”¥ Hotfix merge:  $hotfixBranch â†’ Release" --no-edit 2>&1
              
              if ($LASTEXITCODE -ne 0) {
                  Write-Host "##[warning]Conflict detected, aborting merge..."
                  git merge --abort 2>&1
                  Write-Host "##[warning]Hotfix â†’ Release manuel merge gerekiyor."
              } else {
                  git push origin release 2>&1
                  Write-Host "âœ… Hotfix â†’ Release baÅŸarÄ±lÄ±!"
              }
              
              # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
              # ADIM 2: Release â†’ Sandbox
              # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
              Write-Host ""
              Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
              Write-Host "ğŸ“Œ ADIM 2: Release â†’ Sandbox"
              Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
              
              git checkout sandbox 2>&1
              git pull origin sandbox --no-edit 2>&1
              
              $mergeOutput = git merge origin/release -m "[skip ci] ğŸ”„ Auto-merge:  Release â†’ Sandbox (after hotfix)" --no-edit 2>&1
              
              if ($LASTEXITCODE -ne 0) {
                  Write-Host "##[warning]Conflict detected, aborting merge..."
                  git merge --abort 2>&1
                  Write-Host "##[warning]Release â†’ Sandbox manuel merge gerekiyor."
              } else {
                  git push origin sandbox 2>&1
                  Write-Host "âœ… Release â†’ Sandbox baÅŸarÄ±lÄ±!"
              }
              
              Write-Host ""
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
              Write-Host "âœ… HOTFIX BACK-MERGE TAMAMLANDI"
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            displayName: "ğŸ”¥ Execute Hotfix Back-Merge"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # STAGE 8: BUGFIX BACK-MERGE
  # Bugfix release'e merge edildikten sonra sandbox'a da yayÄ±lmalÄ±
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - stage: BackMergeFromBugfix
    displayName:  "ğŸ› Bugfix Back-Merge"
    dependsOn: ReleaseStaging
    condition:  |
      and(
        succeeded(),
        eq(variables.isBugfix, true)
      )
    jobs:
      - job: SyncAfterBugfix
        displayName:  "Sync Sandbox After Bugfix"
        steps: 
          - checkout: self
            persistCredentials: true
            fetchDepth: 0

          - powershell: |
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
              Write-Host "           ğŸ› BUGFIX BACK-MERGE BAÅLATILIYOR                  "
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
              
              git config user.email "devops-bot@pargesoft.com"
              git config user.name "DevOps Bot"
              git fetch origin --prune
              
              $bugfixBranch = "$(Build.SourceBranch)" -replace "refs/heads/", ""
              
              # Bugfix â†’ Sandbox (release Ã¼zerinden)
              Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
              Write-Host "ğŸ“Œ Bugfix Sync: Release â†’ Sandbox"
              Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
              
              git checkout sandbox 2>&1
              git pull origin sandbox --no-edit 2>&1
              
              $mergeOutput = git merge origin/release -m "[skip ci] ğŸ› Bugfix sync: Release â†’ Sandbox" --no-edit 2>&1
              
              if ($LASTEXITCODE -ne 0) {
                  Write-Host "##[warning]Conflict detected, aborting merge..."
                  git merge --abort 2>&1
                  Write-Host "##[warning]Release â†’ Sandbox manuel merge gerekiyor."
              } else {
                  git push origin sandbox 2>&1
                  Write-Host "âœ… Bugfix sandbox'a sync edildi!"
              }
              
              Write-Host ""
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
              Write-Host "âœ… BUGFIX BACK-MERGE TAMAMLANDI"
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            displayName: "ğŸ› Execute Bugfix Back-Merge"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # STAGE 9: CLEANUP (Merge edilen branch'leri temizle)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - stage:  Cleanup
    displayName: "ğŸ§¹ Cleanup"
    dependsOn: 
      - BackMergeFromMain
      - BackMergeFromHotfix
      - BackMergeFromBugfix
    condition: |
      and(
        always(),
        or(
          succeeded('BackMergeFromMain'),
          succeeded('BackMergeFromHotfix'),
          succeeded('BackMergeFromBugfix')
        ),
        or(
          eq(variables.isHotfix, true),
          eq(variables.isBugfix, true)
        )
      )
    jobs:
      - job: CleanupBranches
        displayName: "Cleanup Merged Branches"
        steps:
          - checkout: self
            persistCredentials: true
            fetchDepth:  0

          - powershell: |
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
              Write-Host "                    ğŸ§¹ BRANCH CLEANUP                         "
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
              
              $sourceBranch = "$(Build.SourceBranch)" -replace "refs/heads/", ""
              
              Write-Host "Branch '$sourceBranch' temizlenecek..."
              
              git config user.email "devops-bot@pargesoft.com"
              git config user.name "DevOps Bot"
              
              # Uzak branch'i sil
              git push origin --delete $sourceBranch 2>&1
              
              if ($LASTEXITCODE -eq 0) {
                  Write-Host "âœ… Branch '$sourceBranch' silindi."
              } else {
                  Write-Host "##[warning]Branch silinemedi veya zaten silinmiÅŸ."
              }
              
              Write-Host ""
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            displayName: "ğŸ§¹ Delete Merged Branch"
